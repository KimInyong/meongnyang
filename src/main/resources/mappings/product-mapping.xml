<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProductDAO">

	<insert id="insertProduct" parameterType="product">
        INSERT INTO product
        VALUES(#{productTbCode}, #{productCategoryTbNo}, #{productTbName}, SYSDATE, #{productTbDetail})
    </insert>

    <delete id="deleteProduct" parameterType="product">
        DELETE FROM product
        WHERE PRODUCT_TB_CODE=#{productTbCode}
    </delete>

    <select id="selectProductList" parameterType="product" resultType="product">
        SELECT
            PRODUCT_TB_CODE,
            PRODUCT_CATEGORY_TB_NO,
            PRODUCT_TB_NAME,
            PRODUCT_TB_REG_DATE,
            PRODUCT_TB_DETAIL
        FROM product
    </select>

    <select id="selectProduct" parameterType="product" resultType="product">
        SELECT
            PRODUCT_TB_CODE,
            PRODUCT_CATEGORY_TB_NO,
            PRODUCT_TB_NAME,
            PRODUCT_TB_REG_DATE,
            PRODUCT_TB_DETAIL
        FROM product
        WHERE PRODUCT_TB_CODE=#{productTbCode}
    </select>

    <update id="updateProduct" parameterType="product">
        UPDATE product
        SET
            PRODUCT_CATEGORY_TB_NO=#{productCategoryTbNo},
            PRODUCT_TB_NAME=#{productTbName}
            <if test="productTbDetail != null">
                ,PRODUCT_TB_DETAIL=#{productTbDetail}
            </if>
        WHERE PRODUCT_TB_CODE=#{productTbCode}
    </update>

    <select id="selectProductOverviewList" parameterType="product" resultType="product">
        SELECT
            p.PRODUCT_TB_CODE,
            p.PRODUCT_CATEGORY_TB_NO,
            p.PRODUCT_TB_NAME,
            p.PRODUCT_TB_REG_DATE,
            p.PRODUCT_TB_DETAIL,
            pc.PRODUCT_CATEGORY_TB_PARENT,
            pc.PRODUCT_CATEGORY_TB_MEDIAN,
            pc.PRODUCT_CATEGORY_TB_SUB,
            (
                SELECT
                    COUNT(*)
                FROM pd_image pi
                WHERE p.PRODUCT_TB_CODE = pi.PRODUCT_TB_CODE
            ) "product_image_count",
            (
                SELECT
                    COUNT(*)
                FROM pd_sale ps
                WHERE p.PRODUCT_TB_CODE = ps.PRODUCT_TB_CODE
            ) "product_sale_count"
        FROM product p JOIN product_category pc
        ON p.PRODUCT_CATEGORY_TB_NO = pc.PRODUCT_CATEGORY_TB_NO
        WHERE PRODUCT_TB_REG_DATE BETWEEN #{dayFrom} AND #{dayTo}
    </select>

</mapper>
