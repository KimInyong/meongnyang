<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ClientLoginDAO">

	<select id="selectClientLoginCheck" resultType="clientLogin">
		SELECT
			customer_tb_no,
			customer_tb_name,
			customer_tb_password,
			customer_tb_email,
			customer_tb_phone,
			customer_tb_join_date,
			customer_tb_point,
			customer_tb_last_login,
			customer_tb_pw_change,
			customer_tb_join_path,
			customer_tb_state
		FROM customer
		WHERE customer_tb_email = #{customerTbEmail} 
	</select>
	
	<insert id="insertRegistry" parameterType="clientLogin" >
		INSERT INTO customer (customer_tb_no, customer_tb_name, customer_tb_password,
								customer_tb_email, customer_tb_join_date)
		VALUES(customer_seq.nextval, #{customerTbName}, #{customerTbPassword},
		#{customerTbEmail}, sysdate)
	</insert>

	<update id="updateClientLastLogin" parameterType="clientLogin">
		UPDATE customer
		SET
			customer_tb_last_login = sysdate
		WHERE
			customer_tb_no = #{customerTbNo}
	</update>
	
	<update id="updateMyinfoPhone" parameterType="clientLogin">
		UPDATE customer
		SET
			customer_tb_phone = #{customerTbPhone}
		WHERE customer_tb_no = #{customerTbNo}
	</update>
	
	<update id="updateMyinfoPassword" parameterType="clientLogin">
		UPDATE customer
		SET
			customer_tb_password = #{customerTbPassword}, customer_tb_pw_change = sysdate
		WHERE customer_tb_no = #{customerTbNo}
	</update>

	<delete id="deleteMyinfoCustomer" parameterType="clientLogin">
		DELETE FROM customer
		WHERE customer_tb_password =#{customerTbPassword}
	</delete>
	
	<update id="updatePointUse" parameterType="orderProc">
		UPDATE CUSTOMER
		SET
			CUSTOMER_TB_POINT = CUSTOMER_TB_POINT-#{pdOrderTbUsedPoint}
		WHERE CUSTOMER_TB_NO = #{customerTbNo}
	</update>

	<update id="updatePointRollback" parameterType="orderProc">
		UPDATE CUSTOMER
		SET
			CUSTOMER_TB_POINT = CUSTOMER_TB_POINT+#{pdOrderTbUsedPoint}
		WHERE CUSTOMER_TB_NO = #{customerTbNo}
	</update>

	<update id="updatePointPlus" parameterType="orderProc">
		UPDATE CUSTOMER
		SET
			CUSTOMER_TB_POINT = CUSTOMER_TB_POINT+ROUND(#{pdOrderTbPayment}/100, 0)
		WHERE CUSTOMER_TB_NO = ${customerTbNo}
	</update>
</mapper>
