<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OverviewDAO">

	<select id="selectOverviewList" parameterType="adminOverview"
		resultType="adminOverview">
		SELECT
		TO_CHAR(user_count_tb_date,'dd')
		"user_count_tb_date",
		user_count_tb_visitors,
		user_count_tb_joiners,
		user_count_tb_outcount
		FROM
		user_count
		WHERE user_count_tb_date BETWEEN '${StartDate}' and
		'${EndDate}'

	</select>

	<select id="selectOverviewListMonth"
		parameterType="adminOverview" resultType="adminOverview">

		
    SELECT
		 K.USER_COUNT_TB_DATE,
		 SUM(USER_COUNT_TB_VISITORS) "userCountTbVisitors",
		 SUM(USER_COUNT_TB_JOINERS) "userCountTbJoiners",
		 SUM(USER_COUNT_TB_OUTCOUNT) "userCountTbOutcount"
		FROM(
		SELECT
		TO_CHAR(USER_COUNT_TB_DATE,'MM') "USER_COUNT_TB_DATE",
		 USER_COUNT_TB_VISITORS,
		 USER_COUNT_TB_JOINERS,
		 USER_COUNT_TB_OUTCOUNT
		FROM USER_COUNT
		) K
		GROUP BY K.USER_COUNT_TB_DATE
		ORDER BY K.USER_COUNT_TB_DATE ASC

	

	</select>


	<insert id="insertUserCount" parameterType="userCount">
		INSERT INTO USER_COUNT
		VALUES (
			SYSDATE,
			#{userCountTbVisitors},
			(
				SELECT
					COUNT(*)
				FROM CUSTOMER
				WHERE TO_CHAR(CUSTOMER_TB_JOIN_DATE,'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
			),
			(
				SELECT
					COUNT(*)
				FROM CUSTOMER
				WHERE CUSTOMER_TB_STATE = 'D' AND TO_CHAR(CUSTOMER_TB_LAST_LOGIN,'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
			)
		)
	</insert>

	<select id="selectSingleByDate" parameterType="userCount" resultType="userCount">

	</select>

</mapper>
